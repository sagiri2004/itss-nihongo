server {
    listen 80;
    server_name localhost;
    root /usr/share/nginx/html;
    index index.html;

    # 1. Load mime types chuẩn
    include /etc/nginx/mime.types;

    # 2. Định nghĩa bổ sung mjs vào global context của server này
    types {
        application/javascript mjs;
        application/javascript js;
    }

    # 3. Gzip & Security Headers (giữ nguyên của bạn)
    gzip on;
    gzip_types text/plain text/css application/javascript application/x-javascript text/javascript;
    add_header X-Content-Type-Options "nosniff" always;

    # 4. Quan trọng: Gộp chung xử lý JS và MJS
    location ~* \.(?:mjs|js)$ {
        add_header Content-Type "application/javascript" always;
        add_header Access-Control-Allow-Origin "*" always;
        expires 1y;
        access_log off;
        add_header Cache-Control "public, immutable";
        try_files $uri =404;
    }

    # 5. SPA routing
    location / {
        try_files $uri $uri/ /index.html;
    }

    # 6. Các assets khác (trừ js/mjs đã xử lý ở trên)
    location ~* \.(?:css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}